from lib.test import assert_eq, assert_true

stat = import stat
os = import os
io = import io

PATH = "tests/tmp_stat_file.txt"
safe_rm_ok = nil
if os.exists(PATH)
  safe_rm_ok = os.remove(PATH)

f = io.open(PATH, "w")
f.write("hello")
f.close()

st = stat.stat(PATH)
assert_true(st != nil, "stat failed")
assert_eq(type(st), "table")
assert_true(st.is_file == true)
assert_true(st.is_dir == false)
assert_true(st.size >= 5)
assert_true(st.mode > 0)
assert_true(st.mtime > 0)

lst = stat.lstat(PATH)
assert_true(lst != nil, "lstat failed")
assert_true(lst.is_file == true)

ok = stat.chmod(PATH, 384) -- 0600
assert_true(ok == true, "chmod failed")

old = stat.umask()
assert_true(old >= 0)

miss = stat.stat("tests/does_not_exist___stat")
assert_true(type(miss) == "string")

rm_ok = os.remove(PATH)
assert_true(rm_ok == true)

print "stat ok"

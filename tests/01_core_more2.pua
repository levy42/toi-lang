fn assert_true(cond, msg = nil)
  if not cond
    error("assert_true failed")

fn assert_eq(actual, expected, msg = nil)
  if actual != expected
    error("assert_eq failed")

-- for-in: key/value and values-only
kv_sum = 0
kv_count = 0
for k, v in {x = 1, y = 2}
  kv_sum = kv_sum + v
  kv_count = kv_count + 1
assert_eq(kv_sum, 3)
assert_eq(kv_count, 2)

akv_sum = 0
akv_count = 0
for k, v in {10, 20, a = 5}
  akv_sum = akv_sum + v
  akv_count = akv_count + 1
assert_eq(akv_sum, 35)
assert_eq(akv_count, 3)

arr = {10, 20, 30}
val_sum = 0
for v in arr
  val_sum = val_sum + v
assert_eq(val_sum, 60)

-- continue in range for
cont_sum = 0
for i in 1..5
  if i == 3
    continue
  cont_sum = cont_sum + i
assert_eq(cont_sum, 12)

idx_sum = 0
idx_val_sum = 0
for i#, v in arr
  idx_sum = idx_sum + i
  idx_val_sum = idx_val_sum + v
assert_eq(idx_sum, 6)
assert_eq(idx_val_sum, 60)
-- slice
s = slice({10, 20, 30, 40, 50}, 2, 4)
assert_eq(s[1], 20)
assert_eq(s[3], 40)
rs = slice({10, 20, 30, 40, 50}, 4, 2, -1)
assert_eq(rs[1], 40)
assert_eq(rs[3], 20)
inner = {x = 1}
ref = slice({inner}, 1, 1)
ref[1].x = 2
assert_eq(inner.x, 2)

-- slice syntax
syn = {10, 20, 30, 40, 50}[2..4:1]
assert_eq(syn[1], 20)
assert_eq(syn[3], 40)
syn2 = {10, 20, 30, 40, 50}[..3]
assert_eq(syn2[1], 10)
assert_eq(syn2[3], 30)
syn3 = {10, 20, 30, 40, 50}[3..]
assert_eq(syn3[1], 30)

-- string slice
ss = "hello"[2..4:1]
assert_eq(ss, "ell")
ss2 = "hello"[..3]
assert_eq(ss2, "hel")

from lib.test import assert_eq, assert_true

obj = {x = 7}
mt = {
  foo = fn(self, n)
    return self.x + n
  answer = 42
  __index = {
    hidden = fn(self)
      return 999
  }
}
setmetatable(obj, mt)

assert_true(obj.foo == nil)
assert_true(obj.hidden != nil)

assert_eq(obj::foo(5), 12)
assert_eq(obj::answer, 42)
assert_true(obj::hidden == nil)

io = import io
b = io.buffer("abc")
assert_eq(b::read(2), "ab")

print "meta method lookup ok"

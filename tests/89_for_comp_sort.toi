from lib.test import assert_eq, assert_true

regex = import regex
table = import table

-- Direct call in for-in header should iterate call result.
parts = {}
for m in regex.finditer("[a-z]+", "a1bb22ccc")
  parts <+ m.match
assert_eq(#parts, 3)
assert_eq(parts[1], "a")
assert_eq(parts[2], "bb")
assert_eq(parts[3], "ccc")

-- Key/value table comprehension.
t = {a = 1, b = 2}
scaled = {k = v * 10 for k, v in t}
assert_eq(scaled.a, 10)
assert_eq(scaled.b, 20)

-- Dynamic key expression in key/value table comprehension.
prefixed = {("x" + k) = v for k, v in t}
assert_eq(prefixed.xa, 1)
assert_eq(prefixed.xb, 2)

-- table.sort should honor custom comparator.
vals = {9, 1, 5, 3}
table.sort(vals, fn(a, b)
  return a > b
)
assert_eq(vals[1], 9)
assert_eq(vals[2], 5)
assert_eq(vals[3], 3)
assert_eq(vals[4], 1)

-- Numeric comparator result is also accepted.
vals2 = {3, 1, 2}
table.sort(vals2, fn(a, b)
  return a - b
)
assert_eq(vals2[1], 1)
assert_eq(vals2[2], 2)
assert_eq(vals2[3], 3)

print "for/comprehension/sort ok"

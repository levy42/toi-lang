from lib.test import assert_eq, assert_true

struct = import struct
binary = import binary
string = import string

b = struct.pack("10s I", "abc", 123456)
hex = binary.hex(b)
assert_eq(hex, "6162630000000000000040e20100")

vals = struct.unpack("10s I", b)
assert_eq(vals[2], 123456)
assert_true(string.sub(vals[1], 1, 3) == "abc")

be = struct.pack(">H I", 4660, 16909060)
assert_eq(binary.hex(be), "123401020304")
u = struct.unpack(">H I", be)
assert_eq(u[1], 4660)
assert_eq(u[2], 16909060)

le = struct.pack("<H I", 4660, 16909060)
assert_eq(binary.hex(le), "341204030201")

multi = struct.pack("<2B 2h", 1, 255, -2, 300)
mu = struct.unpack("<2B 2h", multi)
assert_eq(mu[1], 1)
assert_eq(mu[2], 255)
assert_eq(mu[3], -2)
assert_eq(mu[4], 300)

caught = false
try
  struct.unpack("I", "abc")
except e
  caught = true
  assert_true(e has "buffer too short")
assert_true(caught)

print "struct ok"

from lib.test import assert_eq

a = 10
a += 5
assert_eq(a, 15)
a -= 3
assert_eq(a, 12)
a *= 2
assert_eq(a, 24)
a /= 6
assert_eq(a, 4)
a %= 3
assert_eq(a, 1)

fn local_flow()
  x = 100
  x -= 25
  x *= 2
  x += 5
  x /= 5
  return x

assert_eq(local_flow(), 31)

fn make_acc(n)
  fn add(v)
    n += v
    return n
  return add

acc = make_acc(1)
assert_eq(acc(2), 3)
assert_eq(acc(4), 7)

b = (a += 9)
assert_eq(a, 10)
assert_eq(b, 10)

left = {1, 2}
alias = left
left += {3, 4}
assert_eq(left[1], 1)
assert_eq(left[2], 2)
assert_eq(left[3], 3)
assert_eq(left[4], 4)
assert_eq(alias[4], 4)

base = {10, 20}
other = base
base = base + {30}
assert_eq(base[3], 30)
assert_eq(other[3], nil)

print "compound assign ok"

fn assert_true(cond, msg = nil)
  if not cond
    error("assert_true failed")

fn alloc_round(count)
  for i in 1..count
    n = i + 1
    a = {i, n}
    b = {left = a, right = {v = i}}
    a.back = b

start = mem()

for round in 1..40
  alloc_round(1200)
  gc

after = mem()
assert_true(after <= start + 393216)

root = {}
for i in 1..3000
  root[i] = {v = i}

for i in 1..5
  gc

assert_true(root[1].v == 1)
assert_true(root[3000].v == 3000)

root = nil
gc


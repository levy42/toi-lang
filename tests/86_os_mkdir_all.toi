from lib.test import assert_true

os = import os

ROOT = "tests/tmp_mkdir_all_case"
NEST = ROOT + "/a/b/c"

fn safe_rmdir(path)
  if os.exists(path) and os.isdir(path)
    os.rmdir(path)

safe_rmdir(ROOT + "/a/b/c")
safe_rmdir(ROOT + "/a/b")
safe_rmdir(ROOT + "/a")
safe_rmdir(ROOT)

miss = os.mkdir(NEST)
assert_true(type(miss) == "string")

ok = os.mkdir(NEST, true)
assert_true(ok == true, "mkdir -p failed")
assert_true(os.isdir(ROOT))
assert_true(os.isdir(ROOT + "/a"))
assert_true(os.isdir(ROOT + "/a/b"))
assert_true(os.isdir(ROOT + "/a/b/c"))

ok2 = os.mkdir(NEST, true)
assert_true(ok2 == true, "mkdir -p idempotent failed")

safe_rmdir(ROOT + "/a/b/c")
safe_rmdir(ROOT + "/a/b")
safe_rmdir(ROOT + "/a")
safe_rmdir(ROOT)

print "os mkdir all ok"

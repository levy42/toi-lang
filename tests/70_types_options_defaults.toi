from lib.test import assert_eq, assert_true, expect_error

types = import lib.types

assert_eq(types.Str.check("x"), "x")
assert_true(types.Bool.check(true))
assert_eq(types.Int.check(7), 7)

short_name_t = types.String(max_len = 5, pattern = "A")
assert_eq(short_name_t.check("Ada"), "Ada")
err1 = expect_error(fn()
  short_name_t.check("Long Name")
)
assert_true(err1 has "$")

adult_inline_t = types.Integer(min = 18, max = 120)
assert_eq(adult_inline_t.check(30), 30)
err2 = expect_error(fn()
  adult_inline_t.check(17)
)
assert_true(err2 has "$")

next_id = 0
profile_defaults_t = types.Record({
  name = types.String(default = "Anonymous"),
  age = types.Integer(default = 18),
  uid = types.String(default = fn()
    next_id = next_id + 1
    return "u-" + str(next_id)
  )
})

v1 = profile_defaults_t.check({})
v2 = profile_defaults_t.check({})
assert_eq(v1.name, "Anonymous")
assert_eq(v1.age, 18)
assert_true(v1.uid != v2.uid)

print "types options/defaults ok"

from lib.test import assert_eq

global coroutine = import coroutine

fn seq_body()
  yield 2
  yield 4
  yield 6
  yield 8
  yield 10

fn seq_next(self, control)
  if coroutine.status(self.co) == "dead"
    return nil, nil
  v = nil
  v = coroutine.resume(self.co)
  if coroutine.status(self.co) == "dead"
    return nil, nil
  self.i = self.i + 1
  return self.i, v

fn seq()
  g = {i = 0}
  g.co = coroutine.create(seq_body)
  g.__next = seq_next
  return g

g1 = seq()
sum = 0
for v in g1
  sum = sum + v
assert_eq(sum, 30)

print "yield generators ok"
